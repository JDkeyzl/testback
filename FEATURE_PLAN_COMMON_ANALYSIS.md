# 前N名股票共同点分析功能规划

## 📋 功能概述

分析筛选出的前N名股票的共同特征，帮助用户发现优质股票的共同规律。

## 🎯 功能需求

### 1. 用户交互流程
```
用户操作：
1. 在大浪淘沙页面完成筛选，得到结果列表
2. 点击"分析共同点"按钮
3. 选择要分析的前N名（默认10，可配置）
4. 查看分析结果
```

### 2. 分析维度

#### 2.1 行业分布分析
- **统计项**：各行业出现的次数和占比
- **展示方式**：饼图 + 列表
- **数据来源**：`all_stock_with_industry.json` 中的 `industry` 字段
- **输出示例**：
  ```
  行业分布：
  - J66货币金融服务: 3只 (30%)
  - C36汽车制造业: 2只 (20%)
  - G56航空运输业: 2只 (20%)
  - 其他: 3只 (30%)
  ```

#### 2.2 技术指标共同特征
- **区间收益范围**：最小值、最大值、平均值、中位数
- **最大回撤范围**：最小值、最大值、平均值
- **波动率范围**：最小值、最大值、平均值
- **Sharpe比率范围**：最小值、最大值、平均值
- **趋势斜率范围**：最小值、最大值、平均值
- **成交量健康度范围**：最小值、最大值、平均值

#### 2.3 价格特征
- **起始价格范围**：最小值、最大值、平均值
- **结束价格范围**：最小值、最大值、平均值
- **价格区间分布**：<10元、10-50元、50-100元、>100元

#### 2.4 综合评分分布
- **评分范围**：最小值、最大值、平均值、中位数
- **评分分布**：<0.3、0.3-0.5、0.5-0.7、>0.7

#### 2.5 交易日数特征
- **交易日数范围**：最小值、最大值、平均值
- **数据完整性**：平均交易日数

## 🏗️ 技术实现方案

### 1. 前端实现

#### 1.1 UI组件
```jsx
位置：src/pages/BestStocksPage.jsx

新增组件：
- "分析共同点"按钮（在结果表格上方）
- 分析配置弹窗（选择前N名）
- 分析结果展示卡片（包含多个统计图表）
```

#### 1.2 状态管理
```javascript
const [analysisTopN, setAnalysisTopN] = useState(10)  // 分析前N名
const [showAnalysis, setShowAnalysis] = useState(false)  // 是否显示分析结果
const [analysisResult, setAnalysisResult] = useState(null)  // 分析结果数据
const [isAnalyzing, setIsAnalyzing] = useState(false)  // 分析中状态
```

#### 1.3 图表库选择
- **推荐**：使用 `recharts`（React图表库，轻量级）
- **备选**：`chart.js` 或 `echarts-for-react`
- **图表类型**：
  - 饼图：行业分布
  - 柱状图：价格区间分布、评分分布
  - 箱线图：技术指标范围（可选）

### 2. 后端实现

#### 2.1 API端点
```python
POST /api/v1/best-stocks/analyze-common
请求体：
{
  "symbols": ["600000", "600001", ...],  // 要分析的股票代码列表
  "topN": 10  // 分析前N名（可选，如果symbols为空则使用）
}

响应：
{
  "ok": true,
  "analysis": {
    "industryDistribution": {
      "J66货币金融服务": 3,
      "C36汽车制造业": 2,
      ...
    },
    "technicalIndicators": {
      "return": {"min": 5.2, "max": 25.8, "avg": 15.3, "median": 14.5},
      "maxDrawdown": {"min": 2.1, "max": 8.5, "avg": 5.2},
      ...
    },
    "priceFeatures": {
      "startPrice": {"min": 5.2, "max": 45.8, "avg": 18.5},
      "endPrice": {"min": 6.1, "max": 52.3, "avg": 21.2},
      "priceRangeDistribution": {
        "<10": 2,
        "10-50": 6,
        "50-100": 1,
        ">100": 1
      }
    },
    "scoreDistribution": {
      "min": 0.45,
      "max": 0.82,
      "avg": 0.65,
      "median": 0.67,
      "distribution": {
        "<0.3": 0,
        "0.3-0.5": 1,
        "0.5-0.7": 5,
        ">0.7": 4
      }
    },
    "tradingDays": {
      "min": 20,
      "max": 30,
      "avg": 25
    }
  }
}
```

#### 2.2 后端逻辑
```python
位置：backend/app/api/backtest.py

函数：analyze_common_features(symbols, results_data)
功能：
1. 获取股票行业信息（从all_stock_with_industry.json）
2. 统计行业分布
3. 计算各项技术指标的范围和平均值
4. 分析价格特征
5. 分析评分分布
6. 返回统计结果
```

## 📊 展示界面设计

### 1. 分析结果卡片布局
```
┌─────────────────────────────────────┐
│  前10名股票共同点分析                │
├─────────────────────────────────────┤
│                                     │
│  📊 行业分布                        │
│  [饼图]                             │
│  • J66货币金融服务: 3只 (30%)      │
│  • C36汽车制造业: 2只 (20%)        │
│  ...                                │
│                                     │
│  📈 技术指标特征                    │
│  ┌─────────┬──────┬──────┬──────┐  │
│  │ 指标    │ 最小 │ 最大 │ 平均 │  │
│  ├─────────┼──────┼──────┼──────┤  │
│  │ 区间收益│ 5.2% │25.8% │15.3% │  │
│  │ 最大回撤│ 2.1% │ 8.5% │ 5.2% │  │
│  │ 波动率  │ 12.3%│28.5% │18.2% │  │
│  │ Sharpe  │ 0.45 │ 1.82 │ 1.15 │  │
│  └─────────┴──────┴──────┴──────┘  │
│                                     │
│  💰 价格特征                        │
│  • 起始价格: 5.2 - 45.8元 (平均18.5)│
│  • 结束价格: 6.1 - 52.3元 (平均21.2)│
│  • 价格分布: [柱状图]               │
│                                     │
│  ⭐ 综合评分分布                    │
│  • 评分范围: 0.45 - 0.82 (平均0.65)│
│  • 评分分布: [柱状图]               │
│                                     │
│  📅 交易日数                        │
│  • 范围: 20 - 30天 (平均25天)      │
│                                     │
└─────────────────────────────────────┘
```

### 2. 交互功能
- **导出分析报告**：导出为PDF或CSV
- **对比分析**：可以对比不同N值的分析结果
- **筛选条件**：可以按行业、价格区间等筛选后再分析

## 🔧 实现步骤

### Phase 1: 基础功能
1. ✅ 添加"分析共同点"按钮
2. ✅ 实现后端API端点
3. ✅ 实现基础统计逻辑（行业分布、指标范围）
4. ✅ 前端展示基础统计结果

### Phase 2: 可视化
1. ✅ 集成图表库（recharts）
2. ✅ 实现行业分布饼图
3. ✅ 实现价格分布柱状图
4. ✅ 实现评分分布柱状图

### Phase 3: 增强功能
1. ⬜ 导出分析报告
2. ⬜ 对比分析功能
3. ⬜ 筛选条件功能
4. ⬜ 历史分析记录

## 📝 注意事项

1. **性能优化**：
   - 分析结果可以缓存
   - 大量股票时使用分页或限制

2. **数据准确性**：
   - 确保行业数据完整
   - 处理缺失数据的情况

3. **用户体验**：
   - 分析过程显示加载状态
   - 结果展示清晰易懂
   - 支持导出和分享

## ❓ 待确认问题

1. **分析范围**：是否只分析前N名，还是支持用户手动选择股票？
2. **图表类型**：是否需要更多图表类型（如箱线图、散点图）？
3. **导出格式**：需要支持哪些导出格式（PDF、Excel、CSV）？
4. **对比功能**：是否需要对比不同时间段或不同筛选条件的分析结果？
5. **分析深度**：是否需要更深入的分析（如相关性分析、聚类分析）？

---

**请确认以上方案是否符合您的需求，或者提出修改建议！**

